---
title: 'Configuring Frontline for a CMS setup'
layout: 'docs'
---

There are major differences in the desired setup for working on a static site / SPA and a CMS where we have little or no control of the web server generating HTML and serving assets.

We also don't want to worsen our developer experience (DX) and developer features such as style injection (hot reload), javascript injection (hot module reload, HMR), etc. should continue to work as we've come to expect when working in a SPA-like setup (ie. `frontline-starter-spa` or `create-react-app`).

We are working hard to make sure that you need to do as little configuration as possible, however - there are some things that are left up to you to figure out - at least for the time being - because all of our projects varies in terms of folder structure.

## Prerequisites

Before you start updating your Frontline configuration, here's what you need to figure out:

- **Where is the *source* frontend code located?**
- **Where is the *output* directory located?**
- **Where is the *root* directory that the web server serves content from?**
- **What is the *relative* path from the *output* directory, to the *root* directory?**
- **What is the *hostname* of the CMS server?**

As an example, given the project folder structure:

```
my-cms-project
    ├── src\
    │   ├── frontend\
    │   │   └── package.json
    │   │   └── webpack.config.js
    │   │   └── src\
    ├── www\
    │    ├── dist\
    │    │    ├── sub-directory\
```
- the *source* code is located in `src/frontend`
- the *output* code is located in `www/dist/sub-directory`
- the *root* directory that the server serves from is `www`
- the relative path from `www/dist/sub-directory` to `www` is `"../../"`
- the *hostname* of the CMS server is `"my-cms-project.local"`

*(the hostname can be found in IIS, likely in your HOSTS file, or you can ask a backender on your project)*

The `"../../"` relative path, is called `publicPath` in webpack. It is used to tell webpack plugins how to load runtime assets (images, fonts, lazy-loaded code).

If you have problems loading *assets* or entry points, it is likely an issue with your *publicPath*. Please ask for help if you need help figuring out the relative path.

## Preparation
Make sure you are using the latest `@akqa-frontline/*-config-webpack-plugin` and accompanying packages.

At the time of writing this (26/06/2020) you should have the following versions installed:

```
"@akqa-frontline/asset-config-webpack-plugin": "0.9.0-rc.0",
"@akqa-frontline/font-config-webpack-plugin": "0.9.0-rc.0",
"@akqa-frontline/generate-injection-html-webpack-plugin": "0.9.0-rc.1",
"@akqa-frontline/image-config-webpack-plugin": "0.9.0-rc.0",
"@akqa-frontline/js-config-webpack-plugin": "0.9.0-rc.0",
"@akqa-frontline/scss-config-webpack-plugin": "0.9.0-rc.1",
"@akqa-frontline/webpack-config": "0.9.0-rc.0",
```

Feel free to update all `@akqa-frontline` packages including linting, etc.

## Update the webpack configuration
Now it's time to update the configuration. If you have been using a webpack plugin to generate HTML for injection in your CMS (before we released `generate-injection-html-webpack-plugin`) then disable this in your webpack config.

Same goes for any mutating overrides of the config generated by `@akqa-frontline/webpack-config`.

### Disable legacy bundles in your development environment
When we develop, we want speed over browsersupport. You can always switch to the legacy bundles if you need to debug / test in old browsers.

```javascript
// top of webpack.config.js
const isDevelopment = process.env.NODE_ENV === "development";

// end of webpack.config.js
module.exports = isDevelopment
    ? modernWebpackConfig
    : [modernWebpackConfig, legacyWebpackConfig];
```

### Setup `@akqa-frontline/generate-injection-html-webpack-plugin`
Add the `@akqa-frontline/generate-injection-html-webpack-plugin` to each browserslistEnv target webpack config.

```javascript
const {
    FrontlineGenerateInjectionHtmlWebpackPlugin
} = require("@akqa-frontline/generate-injection-html-webpack-plugin");

const legacyWebpackConfig = FrontlineWebpackConfig(
    "legacy",
    {
        ... // left out for brevity
        plugins: [
            new FrontlineGenerateInjectionHtmlWebpackPlugin({
                browserslistEnv: "legacy"
            })
        ],
        ... // left out for brevity
    }
);

const modernWebpackConfig = FrontlineWebpackConfig(
    "modern",
    {
        ... // left out for brevity
        plugins: [
            new FrontlineGenerateInjectionHtmlWebpackPlugin({
                browserslistEnv: "legacy"
            })
        ],
        ... // left out for brevity
    }
);
```

### Disable the default HTML generation in `@akqa-frontline/webpack-config`
When working on a SPA, you work via an index.html file, which also gets compiled to the output dir. Since the CMS server will take care of sending markup to the client, we can disable this feature.

To disable this feature, pass a third argument to the `FrontlineWebpackConfig` factory in your webpack config. *You should never pass different configrations for different browserslistEnv's.*

```javascript
const sharedFrontlineWebpackConfigOptions = {
    generateHTML: false
};

const legacyWebpackConfig = FrontlineWebpackConfig(
    "legacy",
    {
        ... // left out for brevity
    },
    sharedFrontlineWebpackConfigOptions
);

const modernWebpackConfig = FrontlineWebpackConfig(
    "modern",
    {
        ... // left out for brevity
    },
    sharedFrontlineWebpackConfigOptions
);
```

### Update the common webpack configuration
Time to update the dev-server, and output configurations. This is where we need the info we gathered at the beginning of this guide.

#### output

```javascript
const path = require("path");

const sharedWebpackConfig = {
    output: {
        // the output code (www/dist/sub-directory in the example)
        // this must be an absolute path (use path.resolve())
        path: path.resolve(__dirname, '../../www/dist/sub-directory'),

        // the relative path from the output dir to the root dir where content is served from
        // this can not be an absolute path as it is used *in* the generated code to load assets and modules
        // should always end with trailing slash
        publicPath: '../../'
    },
    ... // left out for brevity
}
```
#### dev-server

```javascript
const path = require("path");

const sharedWebpackConfig = {
    ... // left out for brevity
    devServer: {
        proxy: {
            '*': {
                // the hostname (my-cms-project.local in the example) of the CMS
                // prefixed with http:// (or https:// if your webserver supports that).
                target: 'http://my-cms-project.local'
            }
        },

        // since we are using the CMS web server to serve assets,
        // we can't use webpack-dev-servers internal memory-based filesystem
        writeToDisk: true
    }
    ... // left out for brevity
}
```

### Update any clean script to clean the output directory
If you are using a clean script before you build in your `package.json` (probably `rimraf`), remember to update the path.

### Update the .cshtml file(s) where you normally insert script tags, and links to stylesheets
When using the `@akqa-frontline/generate-injection-html-webpack-plugin` two HTML files will be generated in your output folder - `body.generated.html` and `head.generated.html`.

You should read (from filesystem) and inject these in the `.cshtml` file(s) - normally this is in a so called layout file:

```html
<!doctype html>
<html>
  <head>
    <!-- latest compiled and minified JavaScript -->
    @Html.Raw(File.ReadAllText(... path to head.generated.html ...))
  </head>
  <body>

    <!-- latest compiled and minified JavaScript -->
    @Html.Raw(File.ReadAllText(... path to body.generated.html ...))
  </body>
</html>
```

The above example uses C# and is not framework specific. But you should find a way to declare the absolute path to the two HTML files either via C# or using frameworks specific methods.

Reach out to a backend developer to get help setting this up for your project.

### Test it out!
Yay let's test that our configuration works, first make sure you can reach the CMS webserver on it's default hostname (ie. http://my-cms-project.local).

It would also be good to test that we can work with assets as we expect:

- use `background-image: url(...)` in a SCSS file
- use `@font-face` & `font-family` in a SCSS file
- create a tiny JS setup with, in your main JS entry try eager, and lazy loading a module
- `import a SCSS file in a JS file`
- `import an image (bigger than 10kb) in a JS file`

This should cover the general asset related features and will show us wether or not the webpack module system has been configured correctly.

#### Building
Building is probably the most important thing we do - so let's start by generating a build. Load up the CMS site, and verify that the test scenarios above works as expected.

#### dev-server
If we can build, great - but we also need to test that we can proxy, while still having live-reload and HMR features.

Fire up your dev-server and visit the CMS site, but with port `8080` appended (`8080` is default in Frontline) - ie. http://my-cms-project.local:8080.

Verify the test scenarios above works as expected.

Finally let's test the dev-server features.

In your browser, open up the console - you should see something along the lines of:

```
[WDS] ...
[HMR] ...
[HMR] ...
[HMR] ...
```
If theres no errors reported, and you see the console messages prefixed with WDS and HMR, then live-reload and hot module reloading is working.

Test this by:

- changing the code of a module you've imported in your main JS entry file - if eager loaded, your changes should take place without the browser reloading
- changing a CSS style - as you are used to the changes should be injected without a reload

Note some changes might not be able to be dymanically injected and will cause a full page reload. We are working on making this experience better.

## HELP! The generated HTML files are broken - file contents is not valid HTML
We’ve seen this happen on one project - if you experience this, please reach out to Dennis right away.
